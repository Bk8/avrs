#!/bin/bash

prefix=`rtai-config --prefix`
insmod=/sbin/insmod

if [ "$prefix" == "" ]; then 
	echo "ERROR: please set your PATH variable to <rtai-install>/bin"
	exit
fi

if test \! "x`type -t sudo`" = x; then
	sudo=sudo
fi

sync

if [ "`lsmod | grep rtai`" == "" ]; then
#	$sudo $insmod $prefix/modules/rtai_hal.ko #IsolCpusMask=1
#rtai_sem rtai_mbx

	for module in rtai_hal rtai_lxrt rtai_fifos rtai_sem rtai_mbx; do
		$sudo $insmod $prefix/modules/$module.ko
	done
fi

#sync paranoia might be useful
#sync
#sudo $insmod $MODULES/rtai_hal.ko IsolCpusMask=0;
#sync
#sudo $insmod $MODULES/rtai_lxrt.ko;
#sync
#sudo $insmod $MODULES/rtai_fifos.ko;
#sync

